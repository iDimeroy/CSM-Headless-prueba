<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CMS Admin ‚Äî Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/admin/css/style.css">
    <style>
        .sidebar__sublink {
            transition: color 0.2s;
        }

        .sidebar__sublink:hover {
            color: var(--primary) !important;
            text-decoration: underline !important;
        }

        .sidebar__item-has-submenu.open .sidebar__chevron {
            transform: rotate(180deg);
        }

        .sidebar__item-has-submenu.open .sidebar__submenu {
            display: flex !important;
        }
    </style>
</head>

<body>
    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar__header">
            <span class="sidebar__icon">üèõÔ∏è</span>
            <span class="sidebar__title">P√°gina<br>Institucional</span>
        </div>
        <ul class="sidebar__nav">
            <li><a href="#" class="sidebar__link" data-section="pages">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                    Inicio
                </a></li>
            <li class="sidebar__item-has-submenu" id="landingMenuContainer">
                <a href="#" class="sidebar__link" data-section="landing" id="landingMenuBtn"
                    style="display:flex; align-items:center;">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="3" y1="9" x2="21" y2="9"></line>
                    </svg>
                    Landing Page
                    <svg class="sidebar__chevron" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" style="margin-left:auto; transition: transform 0.2s;">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </a>
                <ul class="sidebar__submenu"
                    style="display:none; list-style:none; padding-left:2.5rem; margin-top:0.5rem; gap:0.6rem; flex-direction:column;">
                    <li><a href="#" class="sidebar__sublink" data-block="Slider"
                            style="color:var(--text-muted); text-decoration:none; font-size:0.9rem; display:block;">Slider</a>
                    </li>
                    <li><a href="#" class="sidebar__sublink" data-block="Capsula"
                            style="color:var(--text-muted); text-decoration:none; font-size:0.9rem; display:block;">Capsula</a>
                    </li>
                    <li><a href="#" class="sidebar__sublink" data-block="Servicios"
                            style="color:var(--text-muted); text-decoration:none; font-size:0.9rem; display:block;">Servicios</a>
                    </li>
                    <li><a href="#" class="sidebar__sublink" data-block="Convocatoria"
                            style="color:var(--text-muted); text-decoration:none; font-size:0.9rem; display:block;">Convocatoria</a>
                    </li>
                </ul>
            </li>
            <li><a href="#" class="sidebar__link" data-section="modulos">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7"></rect>
                        <rect x="14" y="3" width="7" height="7"></rect>
                        <rect x="14" y="14" width="7" height="7"></rect>
                        <rect x="3" y="14" width="7" height="7"></rect>
                    </svg>
                    M√≥dulos
                </a></li>
            <li><a href="#" class="sidebar__link" data-section="noticias">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                        <polyline points="14 2 14 8 20 8" />
                    </svg>
                    Noticia
                </a></li>
            <li style="margin-top:2rem; border-top:1px solid var(--border); padding-top:1rem;"><a href="#"
                    class="sidebar__link" data-section="carousel" style="opacity:0.7;">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="2" y="7" width="20" height="10" rx="2" />
                        <circle cx="8" cy="12" r="1" fill="currentColor" />
                        <circle cx="12" cy="12" r="1" fill="currentColor" />
                        <circle cx="16" cy="12" r="1" fill="currentColor" />
                    </svg>
                    ‚öôÔ∏è Carrusel (Legacy)
                </a></li>
        </ul>
        <div class="sidebar__footer">
            <div class="sidebar__user" id="userInfo">
                <div class="sidebar__avatar">A</div>
                <div>
                    <div class="sidebar__username" id="displayUsername">admin</div>
                    <div class="sidebar__role" id="displayRole">ADMIN</div>
                </div>
            </div>
            <button class="btn btn-ghost btn-sm" id="logoutBtn" title="Cerrar sesi√≥n">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                    <polyline points="16 17 21 12 16 7" />
                    <line x1="21" y1="12" x2="9" y2="12" />
                </svg>
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Top Bar -->
        <header class="topbar">
            <div class="topbar__left">
                <button class="topbar__menu-btn" id="menuToggle">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="3" y1="12" x2="21" y2="12" />
                        <line x1="3" y1="6" x2="21" y2="6" />
                        <line x1="3" y1="18" x2="21" y2="18" />
                    </svg>
                </button>
                <h2 class="topbar__title">P√°ginas</h2>
            </div>
            <button class="btn btn-accent" id="createPageBtn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19" />
                    <line x1="5" y1="12" x2="19" y2="12" />
                </svg>
                Nueva P√°gina
            </button>
        </header>

        <!-- Pages Table -->
        <section class="content-area" id="sectionPages">
            <div class="table-card">
                <table class="data-table" id="pagesTable">
                    <thead>
                        <tr>
                            <th>T√≠tulo</th>
                            <th>Slug</th>
                            <th>Estado</th>
                            <th>Bloques</th>
                            <th>Actualizado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="pagesTableBody">
                        <tr>
                            <td colspan="6" class="table-empty">Cargando p√°ginas...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Landing Page Singleton -->
        <section class="content-area" id="sectionLanding" style="display:none;">
            <div class="modal__body"
                style="background:var(--card-bg);border-radius:var(--radius);box-shadow:var(--shadow-sm);padding:2rem;">
                <h3
                    style="margin-bottom:1.5rem;font-size:1.2rem;color:var(--text);display:flex;align-items:center;gap:0.5rem;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    </svg>
                    Bloques de la P√°gina Principal (Landing)
                </h3>
                <div id="landingBlocksList" class="blocks-list"></div>
                <button type="button" class="btn btn-outline btn-full" id="addLandingBlockBtn" style="margin-top:1rem;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19" />
                        <line x1="5" y1="12" x2="19" y2="12" />
                    </svg>
                    Agregar Bloque
                </button>
            </div>
        </section>

        <!-- Modules Section (Placeholder) -->
        <section class="content-area" id="sectionModulos" style="display:none;">
            <div class="table-card" style="padding:2rem; text-align:center; color:var(--text-muted);">
                <h3>Secci√≥n de M√≥dulos</h3>
                <p>Aqu√≠ se listar√°n los m√≥dulos.</p>
            </div>
        </section>

        <!-- News Section (Placeholder) -->
        <section class="content-area" id="sectionNoticias" style="display:none;">
            <div class="table-card" style="padding:2rem; text-align:center; color:var(--text-muted);">
                <h3>Secci√≥n de Noticias</h3>
                <p>Aqu√≠ se gestionar√°n las noticias.</p>
            </div>
        </section>

        <!-- Carousel Table -->
        <section class="content-area" id="sectionCarousel" style="display:none;">
            <div class="table-card">
                <table class="data-table" id="carouselTable">
                    <thead>
                        <tr>
                            <th>Orden</th>
                            <th>T√≠tulo</th>
                            <th>Descripci√≥n</th>
                            <th>Bot√≥n</th>
                            <th>Estado</th>
                            <th>Fechas</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="carouselTableBody">
                        <tr>
                            <td colspan="7" class="table-empty">Cargando slides...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <!-- Modal: Create/Edit Page -->
    <div class="modal-overlay" id="pageModal" style="display:none;">
        <div class="modal">
            <div class="modal__header">
                <h3 class="modal__title" id="pageModalTitle">Nueva P√°gina</h3>
                <button class="modal__close" id="closePageModal">&times;</button>
            </div>
            <form id="pageForm" class="modal__body">
                <input type="hidden" id="pageId">
                <div class="form-group">
                    <label class="form-label" for="pageTitle">T√≠tulo</label>
                    <input type="text" id="pageTitle" class="form-input" placeholder="Mi P√°gina" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="pageSlug">Slug (URL)</label>
                        <input type="text" id="pageSlug" class="form-input" placeholder="mi-pagina" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="pageStatus">Estado</label>
                        <select id="pageStatus" class="form-input">
                            <option value="DRAFT">Borrador</option>
                            <option value="PUBLISHED">Publicado</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="pageSeoTitle">SEO Title</label>
                    <input type="text" id="pageSeoTitle" class="form-input"
                        placeholder="T√≠tulo para motores de b√∫squeda (opcional)">
                </div>
                <div id="pageFormError" class="form-error" style="display:none;"></div>
                <div class="modal__actions">
                    <button type="button" class="btn btn-ghost" id="cancelPageModal">Cancelar</button>
                    <button type="submit" class="btn btn-primary" id="savePageBtn">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Manage Blocks -->
    <div class="modal-overlay" id="blocksModal" style="display:none;">
        <div class="modal modal--wide">
            <div class="modal__header">
                <h3 class="modal__title">Bloques ‚Äî <span id="blocksPageTitle"></span></h3>
                <button class="modal__close" id="closeBlocksModal">&times;</button>
            </div>
            <div class="modal__body">
                <div id="blocksList" class="blocks-list"></div>
                <button type="button" class="btn btn-outline btn-full" id="addBlockBtn" style="margin-top:1rem;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19" />
                        <line x1="5" y1="12" x2="19" y2="12" />
                    </svg>
                    Agregar Bloque
                </button>
                <div id="blocksFormError" class="form-error" style="display:none;"></div>
            </div>
        </div>
    </div>

    <!-- Modal: Add/Edit Block -->
    <div class="modal-overlay" id="blockEditModal" style="display:none;">
        <div class="modal">
            <div class="modal__header">
                <h3 class="modal__title" id="blockEditTitle">Nuevo Bloque</h3>
                <button class="modal__close" id="closeBlockEditModal">&times;</button>
            </div>
            <form id="blockEditForm" class="modal__body">
                <input type="hidden" id="blockEditId">
                <input type="hidden" id="blockEditPageId">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="blockType">Tipo de Bloque</label>
                        <select id="blockType" class="form-input" required>
                            <option value="Slider" style="font-weight:600;color:var(--primary);">üé† Slider</option>
                            <option value="Capsula" style="font-weight:600;color:var(--primary);">üì∫ C√°psula Informativa
                            </option>
                            <option value="Servicios" style="font-weight:600;color:var(--primary);">‚úÖ Servicios</option>
                            <option value="Convocatoria" style="font-weight:600;color:var(--primary);">üì¢ Convocatoria
                            </option>
                            <option disabled>‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</option>
                            <option value="Titulo1">üìå T√≠tulo 1 (H1)</option>
                            <option value="Titulo2">üìé T√≠tulo 2 (H2)</option>
                            <option value="Imagen">üñºÔ∏è Imagen</option>
                            <option value="Descripcion">üìù Descripci√≥n / Texto</option>
                            <option value="Boton">üîò Bot√≥n</option>
                            <option value="Mapa">üìç Mapa</option>
                            <option value="Acordeon">üìÇ Acorde√≥n</option>
                            <option value="Sandwich">ü•™ Sandwich</option>
                            <option value="HeroSection">ü¶∏ Hero Section</option>
                            <option value="TextWithImage">üìÑ Texto con Imagen</option>
                            <option value="FeaturesList">‚≠ê Lista de Features</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="blockSortOrder">Orden</label>
                        <input type="number" id="blockSortOrder" class="form-input" value="1" min="1" required>
                    </div>
                </div>
                <div id="blockFormFields">
                    <!-- Dynamic fields will be injected here by JS -->
                </div>
                <details class="json-details" style="margin-top:0.5rem;">
                    <summary style="cursor:pointer;color:var(--text-dim);font-size:0.75rem;">‚öôÔ∏è JSON Avanzado (opcional)
                    </summary>
                    <textarea id="blockPayload" class="form-input form-textarea" rows="6"
                        placeholder='{"title": "Mi T√≠tulo", "subtitle": "..."}' style="margin-top:0.5rem;"></textarea>
                </details>
                <div id="blockEditError" class="form-error" style="display:none;"></div>
                <div class="modal__actions">
                    <button type="button" class="btn btn-ghost" id="cancelBlockEditModal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar Bloque</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Create/Edit Carousel Slide -->
    <div class="modal-overlay" id="carouselModal" style="display:none;">
        <div class="modal modal--wide">
            <div class="modal__header">
                <h3 class="modal__title" id="carouselModalTitle">Nuevo Slide</h3>
                <button class="modal__close" id="closeCarouselModal">&times;</button>
            </div>
            <form id="carouselForm" class="modal__body">
                <input type="hidden" id="slideId">
                <div class="form-group">
                    <label class="form-label" for="slideTitulo">T√≠tulo</label>
                    <input type="text" id="slideTitulo" class="form-input" placeholder="Ingrese el t√≠tulo del slide..."
                        required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="slideDescripcion">Descripci√≥n</label>
                    <textarea id="slideDescripcion" class="form-input" rows="3"
                        placeholder="Breve descripci√≥n del elemento del carrusel..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label" for="slideImagenUrl">Img Predeterminada (URL)</label>
                    <input type="text" id="slideImagenUrl" class="form-input" placeholder="https://...">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="slideFechaInicio">Fecha de Inicio</label>
                        <input type="datetime-local" id="slideFechaInicio" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="slideFechaFinal">Fecha Final</label>
                        <input type="datetime-local" id="slideFechaFinal" class="form-input">
                    </div>
                </div>
                <div
                    style="background:var(--bg);border:1px solid var(--border);border-radius:var(--radius);padding:1rem;margin-top:0.5rem;">
                    <label class="form-label">Bot√≥n</label>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="slideBotonTexto" style="font-size:0.7rem;">T√≠tulo</label>
                            <input type="text" id="slideBotonTexto" class="form-input" placeholder="Texto del bot√≥n...">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="slideBotonUrl" style="font-size:0.7rem;">Link</label>
                            <input type="text" id="slideBotonUrl" class="form-input" placeholder="https://...">
                        </div>
                    </div>
                </div>
                <div class="form-row" style="margin-top:1rem;">
                    <div class="form-group">
                        <label class="form-label" for="slideOrden">Orden</label>
                        <input type="number" id="slideOrden" class="form-input" value="1" min="1" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="slideEstado">Estado</label>
                        <select id="slideEstado" class="form-input">
                            <option value="DRAFT">Borrador</option>
                            <option value="PUBLISHED">Publicado</option>
                        </select>
                    </div>
                </div>
                <div id="carouselFormError" class="form-error" style="display:none;"></div>
                <div class="modal__actions">
                    <button type="button" class="btn btn-ghost" id="cancelCarouselModal">Cancelar</button>
                    <button type="submit" class="btn btn-accent" id="saveSlideBtn">Publicar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script src="/admin/js/api.js"></script>
    <script src="/admin/js/block-forms.js"></script>
    <script src="/admin/js/admin.js"></script>
</body>

</html>