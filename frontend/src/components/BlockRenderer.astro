---
// BlockRenderer — maps block.type → the correct Astro component
import TextWithImage from './blocks/TextWithImage.astro';
import FeaturesList from './blocks/FeaturesList.astro';
import Titulo1 from './blocks/Titulo1.astro';
import Titulo2 from './blocks/Titulo2.astro';
import Imagen from './blocks/Imagen.astro';
import Descripcion from './blocks/Descripcion.astro';
import Boton from './blocks/Boton.astro';
import Mapa from './blocks/Mapa.astro';
import Acordeon from './blocks/Acordeon.astro';
import SandwichBlock from './blocks/SandwichBlock.astro';
import DocumentRow from './blocks/DocumentRow.astro';

// Landing Page Specific Components
import Hero from './landing/Hero.astro';
import CapsulaTiempo from './landing/CapsulaTiempo.astro';
import Ventajas from './landing/Ventajas.astro';
import Convocatoria from './landing/Convocatoria.astro';

export interface Block {
  id: string;
  type: string;
  sortOrder: number;
  payload: Record<string, unknown>;
}

export interface Props {
  block: Block;
}

const { block } = Astro.props;

const BLOCK_MAP: Record<string, any> = {
  Slider: Hero, // The Hero component handles the Slider structure
  Capsula: CapsulaTiempo,
  Servicios: Ventajas, // The Ventajas component correctly handles the Servicios grid
  Convocatoria: Convocatoria,
  TextWithImage,
  FeaturesList,
  Titulo1,
  Titulo2,
  Imagen,
  Descripcion,
  Boton,
  Mapa,
  Acordeon,
  Sandwich: SandwichBlock,
  DocumentRow,
};

const Component = BLOCK_MAP[block.type];
---

{Component
  ? <Component {...block.payload} />
  : (
    <div class="unknown-block">
      <p>⚠️ Unknown block type: <code>{block.type}</code></p>
    </div>
  )
}

<style>
  .unknown-block {
    padding: 2rem;
    background: rgba(239,68,68,0.1);
    border: 1px solid rgba(239,68,68,0.4);
    border-radius: 0.5rem;
    color: #fca5a5;
    text-align: center;
    margin: 1rem auto;
    max-width: 600px;
  }
  .unknown-block code {
    background: rgba(0,0,0,0.3);
    padding: 0.2em 0.4em;
    border-radius: 0.25rem;
  }
</style>
